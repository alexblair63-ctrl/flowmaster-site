---
import BaseLayout from '../../layouts/BaseLayout.astro';
---

<BaseLayout
  title="Welcome, Scout!"
  description="You're officially a Flowmaster Scout"
  showNav={false}
>
  <div class="welcome-page">
    <div class="welcome-container">
      <div class="logo-container">
        <a href="/" class="logo-link">
          <span class="logo-text">Flowmaster</span>
        </a>
      </div>

      <div class="content animate">
        <h1 class="headline">ðŸŽ‰ Welcome, Scout!</h1>
        <p class="subheadline">You're officially a Flowmaster Scout!</p>

        <!-- Scout Key -->
        <div class="key-container">
          <div class="key-badge">YOUR SCOUT KEY</div>
          <div class="key-display">
            <code id="scout-key" class="key-code">Loading...</code>
            <button id="copy-btn" class="copy-btn" aria-label="Copy key to clipboard">
              <svg id="copy-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              <svg id="check-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
            </button>
          </div>
          <p class="key-subtext">Free for 3 months &bull; Then 50% off Pro</p>
        </div>

        <!-- What's Next -->
        <div class="next-box">
          <h3 class="next-title">What's Next:</h3>
          <ol class="next-list">
            <li>Download Flowmaster and activate with your key</li>
            <li>Learn the product so you can speak authentically</li>
            <li>Scout Dashboard coming soon!</li>
          </ol>
        </div>

        <!-- Download Button -->
        <a href="https://www.flowmaster.live/download" class="btn-download">
          Download Flowmaster
        </a>

        <p class="help-link">Need help? <a href="/docs">Visit our docs</a></p>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" style="display: none;">Key copied!</div>
</BaseLayout>

<style>
  .welcome-page {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem 1rem;
  }

  .welcome-container {
    max-width: 560px;
    width: 100%;
    text-align: center;
  }

  .logo-container {
    margin-bottom: 2.5rem;
    animation: fade-in-up 0.6s ease-out;
  }

  .logo-link { text-decoration: none; }

  .logo-text {
    font-family: var(--font-heading);
    font-size: 2rem;
    font-weight: 700;
    color: #f2f2f2;
  }

  .content.animate {
    animation: fade-in-up 0.6s ease-out 0.2s backwards;
  }

  .headline {
    font-size: 2.5rem;
    margin-bottom: 0.75rem;
    color: #f2f2f2;
  }

  .subheadline {
    font-size: 1.125rem;
    color: var(--color-gray-300);
    margin-bottom: 2rem;
  }

  /* Key Container */
  .key-container {
    background-color: var(--color-bg-secondary);
    border: 2px solid #facf64;
    border-radius: 0.75rem;
    padding: 1.5rem;
    margin-bottom: 2rem;
  }

  .key-badge {
    display: inline-block;
    background-color: #facf64;
    color: #101010;
    font-family: var(--font-heading);
    font-weight: 700;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.25rem 0.75rem;
    border-radius: 0.25rem;
    margin-bottom: 1rem;
  }

  .key-display {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background-color: var(--color-bg-tertiary);
    padding: 1rem;
    border-radius: 0.5rem;
    margin-bottom: 0.75rem;
  }

  .key-code {
    flex: 1;
    font-family: 'Courier New', monospace;
    font-size: 1rem;
    color: #f2f2f2;
    letter-spacing: 0.05em;
    word-break: break-all;
  }

  @media (min-width: 640px) {
    .key-code { font-size: 1.125rem; }
  }

  .copy-btn {
    flex-shrink: 0;
    background-color: #facf64;
    color: #101010;
    border: none;
    border-radius: 0.375rem;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
  }

  .copy-btn:hover {
    background-color: #ffe08a;
  }

  .key-subtext {
    color: var(--color-gray-400);
    font-size: 0.85rem;
    margin: 0;
  }

  /* What's Next */
  .next-box {
    text-align: left;
    background-color: var(--color-bg-secondary);
    border: 1px solid var(--color-bg-tertiary);
    border-radius: 0.75rem;
    padding: 1.5rem;
    margin-bottom: 2rem;
  }

  .next-title {
    font-size: 1.125rem;
    margin-bottom: 0.75rem;
    color: #f2f2f2;
  }

  .next-list {
    margin: 0;
    padding-left: 1.5rem;
    color: var(--color-gray-300);
    line-height: 1.8;
  }

  .next-list li {
    margin-bottom: 0.25rem;
  }

  /* Download Button */
  .btn-download {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: #facf64;
    color: #101010;
    font-family: var(--font-heading);
    font-weight: 700;
    font-size: 1.1rem;
    padding: 1rem 2rem;
    border-radius: 0.75rem;
    text-decoration: none;
    transition: all 0.2s;
    margin-bottom: 1.5rem;
  }

  .btn-download:hover {
    background: #ffe08a;
    box-shadow: 0 10px 20px -5px rgba(250, 207, 100, 0.2);
    transform: translateY(-2px);
  }

  .help-link {
    color: var(--color-gray-500);
    font-size: 0.85rem;
  }

  .help-link a {
    color: #facf64;
    text-decoration: none;
  }

  .help-link a:hover {
    color: #ffe08a;
  }

  /* Toast */
  .toast {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    background-color: #facf64;
    color: #101010;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.5);
    z-index: 1000;
    animation: toast-in 0.3s ease-out;
  }

  @keyframes toast-in {
    from { opacity: 0; transform: translateX(-50%) translateY(10px); }
    to { opacity: 1; transform: translateX(-50%) translateY(0); }
  }

  @keyframes fade-in-up {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>

<script>
  function init() {
    const scoutKey = sessionStorage.getItem('scout_key');
    const keyEl = document.getElementById('scout-key');

    if (scoutKey && keyEl) {
      keyEl.textContent = scoutKey;
    } else if (keyEl) {
      keyEl.textContent = 'Key not found â€” check your email';
    }

    // Copy button
    const copyBtn = document.getElementById('copy-btn');
    const copyIcon = document.getElementById('copy-icon');
    const checkIcon = document.getElementById('check-icon');
    const toast = document.getElementById('toast');

    copyBtn?.addEventListener('click', async () => {
      const key = keyEl?.textContent;
      if (!key) return;

      try {
        await navigator.clipboard.writeText(key);
        if (copyIcon) copyIcon.style.display = 'none';
        if (checkIcon) checkIcon.style.display = 'block';
        if (toast) {
          toast.style.display = 'block';
          setTimeout(() => { toast.style.display = 'none'; }, 2000);
        }
        setTimeout(() => {
          if (copyIcon) copyIcon.style.display = 'block';
          if (checkIcon) checkIcon.style.display = 'none';
        }, 2000);
      } catch (err) {
        // Fallback: select text
        const range = document.createRange();
        if (keyEl) range.selectNodeContents(keyEl);
        window.getSelection()?.removeAllRanges();
        window.getSelection()?.addRange(range);
      }
    });
  }

  init();
</script>
