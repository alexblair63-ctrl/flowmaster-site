---
import BaseLayout from '../../layouts/BaseLayout.astro';

const docs = [
  { title: 'Getting Started', href: '/docs' },
  { title: 'OBS Setup', href: '/docs/obs-setup', current: true },
  { title: 'Configuration', href: '#', comingSoon: true },
  { title: 'Troubleshooting', href: '/docs/troubleshooting' },
];
---

<BaseLayout title="OBS Setup">
  <div class="section-padding pt-32">
    <div class="container-main">
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">

        <!-- Sidebar -->
        <aside class="lg:col-span-1">
          <h3 class="font-semibold mb-4">Documentation</h3>
          <nav class="space-y-2">
            {docs.map(doc => (
              <a
                href={doc.comingSoon ? '#' : doc.href}
                class={`block py-2 px-3 rounded-lg transition-colors ${
                  doc.current
                    ? 'bg-brand-red/20 text-brand-red'
                    : doc.comingSoon
                      ? 'text-gray-600 cursor-not-allowed'
                      : 'text-text-secondary hover:text-white hover:bg-bg-tertiary'
                }`}
              >
                {doc.title}
                {doc.comingSoon && <span class="text-xs ml-2">(soon)</span>}
              </a>
            ))}
          </nav>
          
          <!-- Quick Info Card -->
          <div class="mt-8 p-4 bg-bg-secondary rounded-lg border border-bg-tertiary">
            <h4 class="font-semibold text-sm mb-2">Quick Reference</h4>
            <ul class="text-sm text-text-secondary space-y-1">
              <li>Default Port: <code class="text-brand-red">4455</code></li>
              <li>Password: Optional</li>
              <li>No plugins required</li>
            </ul>
          </div>
        </aside>

        <!-- Main Content -->
        <main class="lg:col-span-3">
          <h1 class="mb-4">OBS Setup Guide</h1>
          <p class="text-xl text-text-secondary mb-4">Connect Flowmaster to OBS via WebSocket</p>
          
          <!-- Status Indicator Explanation -->
          <div class="bg-bg-secondary rounded-lg p-4 mb-8 border border-bg-tertiary">
            <div class="flex items-start gap-4">
              <div class="flex-shrink-0 mt-1">
                <span class="inline-block w-3 h-3 rounded-full bg-brand-red animate-pulse"></span>
              </div>
              <div>
                <p class="font-medium mb-1">Understanding the Connection Status Light</p>
                <p class="text-sm text-text-secondary">
                  The colored dot in Flowmaster's header shows your OBS connection status:
                </p>
                <ul class="text-sm text-text-secondary mt-2 space-y-1">
                  <li><span class="inline-block w-2 h-2 rounded-full bg-green-500 mr-2"></span><strong class="text-white">Green</strong> - Connected to OBS</li>
                  <li><span class="inline-block w-2 h-2 rounded-full bg-brand-red mr-2"></span><strong class="text-white">Red</strong> - Not connected</li>
                  <li><span class="inline-block w-2 h-2 rounded-full bg-yellow-500 mr-2"></span><strong class="text-white">Yellow</strong> - Connecting...</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="space-y-12 text-gray-300">

            <!-- Overview -->
            <section>
              <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-4 mb-6">
                <p class="text-green-400 font-medium">‚úì No plugins required!</p>
                <p class="text-sm text-text-secondary mt-1">
                  Flowmaster connects directly to OBS using the built-in WebSocket server. 
                  No need for Advanced Scene Switcher or external executables.
                </p>
              </div>
            </section>

            <!-- Step 1: Enable WebSocket in OBS -->
            <section>
              <h2 class="text-2xl font-semibold mb-4 flex items-center gap-3">
                <span class="flex items-center justify-center w-8 h-8 rounded-full bg-brand-red text-white text-sm font-bold">1</span>
                Enable WebSocket Server in OBS
              </h2>
              <p class="mb-4">
                OBS has a built-in WebSocket server that Flowmaster uses to detect when you start and stop recording.
              </p>

              <ol class="list-none space-y-4 mb-6">
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">1.1</span>
                  <span>Open OBS Studio</span>
                </li>
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">1.2</span>
                  <span>Go to <strong class="text-white">Tools</strong> ‚Üí <strong class="text-white">WebSocket Server Settings</strong></span>
                </li>
              </ol>

              <!-- Screenshot placeholder: OBS menu -->
              <div class="aspect-video max-w-2xl bg-bg-secondary rounded-lg border border-bg-tertiary flex items-center justify-center mb-6">
                <div class="text-center">
                  <span class="text-gray-500 block mb-2">üì∏ Screenshot needed</span>
                  <span class="text-gray-600 text-sm">OBS menu: Tools ‚Üí WebSocket Server Settings</span>
                </div>
              </div>

              <ol class="list-none space-y-4 mb-6" start="3">
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">1.3</span>
                  <span>Check <strong class="text-white">"Enable WebSocket server"</strong></span>
                </li>
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">1.4</span>
                  <span>Note the <strong class="text-white">Server Port</strong> (default is 4455)</span>
                </li>
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">1.5</span>
                  <span>If you want a password, check "Enable Authentication" and set one (optional)</span>
                </li>
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">1.6</span>
                  <span>Click <strong class="text-white">Apply</strong> or <strong class="text-white">OK</strong></span>
                </li>
              </ol>

              <!-- Screenshot placeholder: OBS WebSocket settings panel -->
              <div class="aspect-video max-w-2xl bg-bg-secondary rounded-lg border border-bg-tertiary flex items-center justify-center">
                <div class="text-center">
                  <span class="text-gray-500 block mb-2">üì∏ Screenshot needed</span>
                  <span class="text-gray-600 text-sm">OBS WebSocket Server Settings panel with "Enable" checked</span>
                </div>
              </div>
            </section>

            <!-- Step 2: Configure Flowmaster -->
            <section>
              <h2 class="text-2xl font-semibold mb-4 flex items-center gap-3">
                <span class="flex items-center justify-center w-8 h-8 rounded-full bg-brand-red text-white text-sm font-bold">2</span>
                Configure Flowmaster
              </h2>
              <p class="mb-4">
                Tell Flowmaster how to connect to your OBS WebSocket server.
              </p>

              <ol class="list-none space-y-4 mb-6">
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">2.1</span>
                  <span>Open <strong class="text-white">Flowmaster</strong></span>
                </li>
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">2.2</span>
                  <span>Click the <strong class="text-white">Settings gear</strong> (‚öôÔ∏è) in the top right</span>
                </li>
              </ol>

              <!-- Screenshot placeholder: Flowmaster header with settings gear highlighted -->
              <div class="aspect-video max-w-2xl bg-bg-secondary rounded-lg border border-bg-tertiary flex items-center justify-center mb-6">
                <div class="text-center">
                  <span class="text-gray-500 block mb-2">üì∏ Screenshot needed</span>
                  <span class="text-gray-600 text-sm">Flowmaster header - highlight the settings gear icon</span>
                </div>
              </div>

              <ol class="list-none space-y-4 mb-6" start="3">
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">2.3</span>
                  <span>Scroll to the <strong class="text-white">OBS Connection</strong> section</span>
                </li>
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">2.4</span>
                  <span>Enter the <strong class="text-white">Port</strong> (same as OBS, default 4455)</span>
                </li>
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">2.5</span>
                  <span>If you set a password in OBS, enter it here. Otherwise leave blank.</span>
                </li>
              </ol>

              <!-- Screenshot placeholder: Flowmaster OBS Connection settings -->
              <div class="aspect-video max-w-2xl bg-bg-secondary rounded-lg border border-bg-tertiary flex items-center justify-center">
                <div class="text-center">
                  <span class="text-gray-500 block mb-2">üì∏ Screenshot needed</span>
                  <span class="text-gray-600 text-sm">Flowmaster Settings - OBS Connection section with Port and Password fields</span>
                </div>
              </div>
            </section>

            <!-- Step 3: Test Connection -->
            <section>
              <h2 class="text-2xl font-semibold mb-4 flex items-center gap-3">
                <span class="flex items-center justify-center w-8 h-8 rounded-full bg-brand-red text-white text-sm font-bold">3</span>
                Test the Connection
              </h2>
              <p class="mb-4">
                Verify that Flowmaster can talk to OBS.
              </p>

              <ol class="list-none space-y-4 mb-6">
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">3.1</span>
                  <span>Make sure <strong class="text-white">OBS is running</strong></span>
                </li>
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">3.2</span>
                  <span>In Flowmaster Settings, click <strong class="text-white">Test Connection</strong></span>
                </li>
              </ol>

              <!-- Screenshot placeholder: Test Connection button -->
              <div class="aspect-video max-w-2xl bg-bg-secondary rounded-lg border border-bg-tertiary flex items-center justify-center mb-6">
                <div class="text-center">
                  <span class="text-gray-500 block mb-2">üì∏ Screenshot needed</span>
                  <span class="text-gray-600 text-sm">Flowmaster Settings - "Test Connection" button highlighted</span>
                </div>
              </div>

              <div class="bg-bg-secondary rounded-lg p-4 mb-6">
                <p class="font-medium mb-2">What to expect:</p>
                <ul class="space-y-2 text-sm">
                  <li class="flex items-center gap-2">
                    <span class="inline-block w-2 h-2 rounded-full bg-green-500"></span>
                    <strong class="text-green-400">Success:</strong> 
                    <span class="text-text-secondary">The status light turns green, and you'll see "Connected to OBS"</span>
                  </li>
                  <li class="flex items-center gap-2">
                    <span class="inline-block w-2 h-2 rounded-full bg-brand-red"></span>
                    <strong class="text-brand-red">Failed:</strong> 
                    <span class="text-text-secondary">Check that OBS is open and the port/password match</span>
                  </li>
                </ul>
              </div>

              <!-- Screenshot placeholder: Successful connection state -->
              <div class="aspect-video max-w-2xl bg-bg-secondary rounded-lg border border-bg-tertiary flex items-center justify-center">
                <div class="text-center">
                  <span class="text-gray-500 block mb-2">üì∏ Screenshot needed</span>
                  <span class="text-gray-600 text-sm">Flowmaster showing green connection status + "Connected to OBS" message</span>
                </div>
              </div>
            </section>

            <!-- Step 4: Start Recording -->
            <section>
              <h2 class="text-2xl font-semibold mb-4 flex items-center gap-3">
                <span class="flex items-center justify-center w-8 h-8 rounded-full bg-brand-red text-white text-sm font-bold">4</span>
                Start Recording & Mark Highlights
              </h2>
              <p class="mb-4">
                Once connected, Flowmaster automatically detects when you start and stop recording.
              </p>

              <ol class="list-none space-y-4 mb-6">
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">4.1</span>
                  <span>Click <strong class="text-white">Start Recording</strong> in OBS (or use your hotkey)</span>
                </li>
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">4.2</span>
                  <span>Flowmaster will automatically switch from "Idle" to <strong class="text-white">"Recording"</strong></span>
                </li>
              </ol>

              <!-- Screenshot placeholder: Flowmaster in Recording state -->
              <div class="aspect-video max-w-2xl bg-bg-secondary rounded-lg border border-bg-tertiary flex items-center justify-center mb-6">
                <div class="text-center">
                  <span class="text-gray-500 block mb-2">üì∏ Screenshot needed</span>
                  <span class="text-gray-600 text-sm">Flowmaster Mark tab showing "Recording" status (not "Idle")</span>
                </div>
              </div>

              <ol class="list-none space-y-4 mb-6" start="3">
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">4.3</span>
                  <span>Press your hotkey (default <kbd class="px-2 py-1 bg-bg-tertiary rounded text-sm">F9</kbd>) to mark highlights during gameplay</span>
                </li>
                <li class="flex gap-3">
                  <span class="text-brand-red font-mono text-sm">4.4</span>
                  <span>Stop recording in OBS - Flowmaster will save your timestamps automatically</span>
                </li>
              </ol>

              <!-- Screenshot placeholder: Flowmaster with timestamps marked -->
              <div class="aspect-video max-w-2xl bg-bg-secondary rounded-lg border border-bg-tertiary flex items-center justify-center">
                <div class="text-center">
                  <span class="text-gray-500 block mb-2">üì∏ Screenshot needed</span>
                  <span class="text-gray-600 text-sm">Flowmaster showing timestamps list with several marks</span>
                </div>
              </div>
            </section>

            <!-- Troubleshooting Quick Tips -->
            <section>
              <h2 class="text-2xl font-semibold mb-4">Troubleshooting</h2>
              
              <div class="space-y-4">
                <details class="bg-bg-secondary rounded-lg border border-bg-tertiary">
                  <summary class="p-4 cursor-pointer font-medium hover:text-brand-red transition-colors">
                    Connection stays red even though OBS is open
                  </summary>
                  <div class="px-4 pb-4 text-text-secondary text-sm space-y-2">
                    <p>Check these common issues:</p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                      <li>Make sure WebSocket Server is <strong class="text-white">enabled</strong> in OBS (Tools ‚Üí WebSocket Server Settings)</li>
                      <li>Verify the port numbers match (default is 4455)</li>
                      <li>If you set a password in OBS, make sure it's entered in Flowmaster</li>
                      <li>Try restarting both OBS and Flowmaster</li>
                      <li>Check if a firewall is blocking the connection</li>
                    </ul>
                  </div>
                </details>

                <details class="bg-bg-secondary rounded-lg border border-bg-tertiary">
                  <summary class="p-4 cursor-pointer font-medium hover:text-brand-red transition-colors">
                    Flowmaster doesn't detect when I start recording
                  </summary>
                  <div class="px-4 pb-4 text-text-secondary text-sm space-y-2">
                    <p>If the connection light is green but recording isn't detected:</p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                      <li>Make sure you're clicking "Start Recording" (not "Start Streaming")</li>
                      <li>Try the <strong class="text-white">Simulate Live</strong> button in Flowmaster to test without OBS</li>
                      <li>Check the Flowmaster logs for any error messages</li>
                    </ul>
                  </div>
                </details>

                <details class="bg-bg-secondary rounded-lg border border-bg-tertiary">
                  <summary class="p-4 cursor-pointer font-medium hover:text-brand-red transition-colors">
                    I was using Advanced Scene Switcher before - do I still need it?
                  </summary>
                  <div class="px-4 pb-4 text-text-secondary text-sm space-y-2">
                    <p><strong class="text-green-400">No!</strong> Flowmaster now connects directly to OBS via WebSocket.</p>
                    <p>You can safely:</p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                      <li>Remove the start/stop macros from Advanced Scene Switcher</li>
                      <li>Delete <code>flowmaster-start.exe</code> and <code>flowmaster-stop.exe</code> if you have them</li>
                      <li>Keep Advanced Scene Switcher if you use it for other things, but it's not needed for Flowmaster</li>
                    </ul>
                  </div>
                </details>

                <details class="bg-bg-secondary rounded-lg border border-bg-tertiary">
                  <summary class="p-4 cursor-pointer font-medium hover:text-brand-red transition-colors">
                    What port should I use?
                  </summary>
                  <div class="px-4 pb-4 text-text-secondary text-sm space-y-2">
                    <p>The default port <code class="text-brand-red">4455</code> works for most people.</p>
                    <p>Only change it if:</p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                      <li>Another application is already using port 4455</li>
                      <li>You changed it in OBS for a specific reason</li>
                    </ul>
                    <p class="mt-2">If you change the port in OBS, make sure to update it in Flowmaster too.</p>
                  </div>
                </details>
              </div>

              <p class="mt-6 text-text-secondary">
                Still having issues? Check our <span class="text-brand-red opacity-50">full troubleshooting guide</span> <span class="text-xs text-text-secondary">(coming soon)</span>
                or <a href="https://discord.gg/flowmaster" target="_blank" rel="noopener noreferrer" class="text-brand-red hover:underline">join our Discord</a> for help.
              </p>
            </section>

            <!-- Success State -->
            <section class="bg-green-500/10 border border-green-500/30 rounded-lg p-6">
              <h2 class="text-xl font-semibold text-green-400 mb-2">‚úì You're all set!</h2>
              <p class="text-text-secondary">
                Flowmaster will now automatically detect your OBS recordings.
                Just start recording, press your hotkey to mark highlights, and stop recording -
                Flowmaster handles the rest.
              </p>
              <div class="mt-4">
                <a href="/docs" class="text-brand-red hover:underline">‚Üê Back to Documentation</a>
              </div>
            </section>

          </div>
        </main>

      </div>
    </div>
  </div>
</BaseLayout>
